\chapter{Deferred Rendering Path in URP}
\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234}{}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234}\index{Deferred Rendering Path in URP@{Deferred Rendering Path in URP}}
\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2429}%
\Hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2429}%
 URP Universal Renderer supports the following Rendering Paths\+:


\begin{DoxyItemize}
\item Forward
\item Forward+
\item Deferred
\end{DoxyItemize}

For information on differences between the rendering paths, see section \href{../urp-universal-renderer.md\#rendering-path-comparison}{\texttt{ Rendering Path comparison}}.

This section describes the Deferred Rendering Path.

~\newline
{\itshape Sample Scene rendered with the Deferred Rendering Path.}

This section contains the following topics\+:


\begin{DoxyItemize}
\item How to select the Deferred Rendering Path
\item Unity Player system requirements
\item Implementation details
\item Relevant code files
\item Shader\+Lab Pass tags
\item Limitations and performance
\end{DoxyItemize}\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2430}{}\doxysection{\texorpdfstring{\label{_how-to-enable}%
How to select the Deferred Rendering Path}{\label{_how-to-enable}%
How to select the Deferred Rendering Path}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2430}
To select the Rendering Path, use the property {\bfseries{Lighting}} \texorpdfstring{$>$}{>} {\bfseries{Rendering Path}} in the URP Universal Renderer asset.



When you select the Deferred Rendering Path, \doxylink{namespace_unity}{Unity} shows the Accurate G-\/buffer normals property.

The {\bfseries{Accurate G-\/buffer normals}} property lets you configure how \doxylink{namespace_unity}{Unity} encodes the normals when storing them in the geometry buffer (G-\/buffer).


\begin{DoxyItemize}
\item {\bfseries{Accurate G-\/buffer normals}} off\+: This option increases performance, especially on mobile GPUs, but might lead to color banding artifacts on smooth surfaces.
\item {\bfseries{Accurate G-\/buffer normals}} on\+: \doxylink{namespace_unity}{Unity} uses the octahedron encoding to store values of normal vectors in the RGB channel of a normal texture. With this encoding, values of normal vectors are more accurate, but the encoding and decoding operations put extra load on the GPU.
\end{DoxyItemize}

For more information about this setting, see the section Encoding of normals in G-\/buffer.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2431}{}\doxysection{\texorpdfstring{\label{_requirements}%
Unity Player system requirements}{\label{_requirements}%
Unity Player system requirements}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2431}
The Deferred Rendering Path has the following requirements and limitations on top of the general system requirements for the \doxylink{namespace_unity}{Unity} \doxylink{class_player}{Player}.


\begin{DoxyItemize}
\item Minimum Shader Model\+: Shader Model 4.\+5.
\item Deferred Rendering Path does not support the Open\+GL and Open\+GL ES API.~\newline
If a project with the Deferred Rendering Path is built for platforms using those API, the application falls back to the Forward Rendering Path.
\end{DoxyItemize}\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2432}{}\doxysection{\texorpdfstring{Implementation details}{Implementation details}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2432}
This section describes the implementation details of this feature, and technical details about how this feature functions.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2433}{}\doxysubsection{\texorpdfstring{G-\/buffer layout}{G-\/buffer layout}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2433}
This section describes how \doxylink{namespace_unity}{Unity} stores material attributes in the G-\/buffer in the Deferred Rendering Path.

The following illustration shows the data structure for each pixel of the render targets that \doxylink{namespace_unity}{Unity} uses in the Deferred Rendering Path.



The data structure consists of the following components.

{\bfseries{Albedo (s\+RGB)}}

This field contains the albedo color in s\+RGB format, 24 bits.

{\bfseries{Material\+Flags}}

This field is a bit field that contains Material flags\+:


\begin{DoxyItemize}
\item Bit 0, {\bfseries{Receive\+Shadows\+Off}}\+: if set, the pixel does not receive dynamic shadows.
\item Bit 1, {\bfseries{Specular\+Highlights\+Off}}\+: if set, the pixel does not receive specular highlights.
\item Bit 2, {\bfseries{Subtractive\+Mixed\+Lighting}}\+: if set, the pixel uses subtractive mixed lighting.
\item Bit 3, {\bfseries{Specular\+Setup}}\+: if set, the Material uses the specular workflow.
\end{DoxyItemize}

Bits 4-\/7 are reserved for future use.

For more technical details, see the file {\ttfamily /\+Shader\+Library/\+Unity\+GBuffer.hlsl}.

{\bfseries{Specular}}

This field contains the following values\+:


\begin{DoxyItemize}
\item Simple\+Lit Material\+: RGB specular color stored in 24 bits.
\item Lit Material with metallic workflow\+: reflectivity stored in 8 bits, 16 bits are not used.
\item Lit Material with specular workflow\+: RGB specular color stored in 24 bits.
\end{DoxyItemize}

{\bfseries{Occlusion}}

This field contains the baked occlusion value from the baked lighting. For real-\/time lighting, \doxylink{namespace_unity}{Unity} calculates the ambient occlusion value by combining the baked occlusion value with the SSAO value.

{\bfseries{Normal}}

This field contains the world space normals encoded in 24 bits. For information on the encoding of normals, see section Encoding of normals in G-\/buffer.

{\bfseries{Smoothness}}

This field stores the smoothness value for the Simple\+Lit and Lit materials.

{\bfseries{Emissive/\+GI/\+Lighting}}

This render target contains the Material emissive output and baked lighting. \doxylink{namespace_unity}{Unity} fills this field during the G-\/buffer Pass. During the deferred shading pass, \doxylink{namespace_unity}{Unity} stores lighting results in this render target.

Render target format\+:


\begin{DoxyItemize}
\item {\bfseries{B10\+G11\+R11\+\_\+\+UFloat\+Pack32}}, unless one of the following conditions is true\+:
\begin{DoxyItemize}
\item In URP Asset, the setting {\bfseries{Quality}} \texorpdfstring{$>$}{>} {\bfseries{HDR}} is turned on, and the target \doxylink{class_player}{Player} platform does not support HDR.
\item In \doxylink{class_player}{Player} Settings, the setting {\bfseries{Preserve\+Framebuffer\+Alpha}} is true.
\end{DoxyItemize}
\item {\bfseries{R16\+G6\+B16\+A16\+\_\+\+SFloat}}, if \doxylink{namespace_unity}{Unity} cannot use {\bfseries{B10\+G11\+R11\+\_\+\+UFloat\+Pack32}} because of the project settings.
\item If \doxylink{namespace_unity}{Unity} cannot use one of the other formats in the list, it uses what the following method returns\+: {\ttfamily System\+Info.\+Get\+Graphics\+Format(Default\+Format.\+HDR)}.
\end{DoxyItemize}

{\bfseries{Shadow\+Mask}}

\doxylink{namespace_unity}{Unity} adds this render target to the G-\/buffer layout when Lighting Mode is set to Subtractive or Shadow mask.

The Subtractive and the Shadow mask modes are optimized for the Forward Rendering Path, and are less efficient in the Deferred Rendering Path. In the Deferred Rendering Path, avoid using these modes and use the Baked Indirect mode instead to improve GPU performance.

{\bfseries{Rendering Layer Mask}}

\doxylink{namespace_unity}{Unity} adds this render target to the G-\/buffer layout when the Use Rendering Layers option is enabled (URP Asset, {\bfseries{Lighting}} \texorpdfstring{$>$}{>} {\bfseries{Use Rendering Layers}}).

Using Rendering Layers might have an impact on the GPU performance. For more information, see the page \href{../features/rendering-layers.md\#performance}{\texttt{ Rendering Layers}}.

{\bfseries{Depth as Color}}

\doxylink{namespace_unity}{Unity} adds this render target to the G-\/buffer layout when Native Render Pass is enabled on platforms that support it. \doxylink{namespace_unity}{Unity} renders depth as a color into this render target. This render target has the following purpose\+:


\begin{DoxyItemize}
\item Improves performance on Vulkan devices.
\item Lets \doxylink{namespace_unity}{Unity} get the depth buffer on Metal API, which does not allow fetching the depth from the Depth\+Stencil buffer within the same render pass.
\end{DoxyItemize}

The format of the Depth as Color render target is {\ttfamily Graphics\+Format.\+R32\+\_\+\+SFloat}.

{\bfseries{Depth\+Stencil}}

\doxylink{namespace_unity}{Unity} reserves the four highest bits of this render target to mark the Material type. See also \href{../urp-shaders/urp-shaderlab-pass-tags.md\#universalmaterialtype}{\texttt{ URP Pass tags\+: Universal\+Material\+Type}}.

For this render target, \doxylink{namespace_unity}{Unity} selects either the {\ttfamily D32\+F\+\_\+\+S8} format, or the {\ttfamily D24\+S8} format depending on the platform.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2434}{}\doxysubsection{\texorpdfstring{\label{_accurate-g-buffer-normals}%
Encoding of normals in G-\/buffer}{\label{_accurate-g-buffer-normals}%
Encoding of normals in G-\/buffer}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2434}
In the Deferred Rendering Path, \doxylink{namespace_unity}{Unity} stores normals in the G-\/buffer. \doxylink{namespace_unity}{Unity} encodes each normal as a 24 bit value.

When you select the {\bfseries{Deferred}} option in the {\bfseries{Rendering Path}} property in the URP Universal Renderer asset, \doxylink{namespace_unity}{Unity} shows the {\bfseries{Accurate G-\/buffer normals}} property.



The {\bfseries{Accurate G-\/buffer normals}} property lets you configure how \doxylink{namespace_unity}{Unity} encodes the normals.


\begin{DoxyItemize}
\item {\bfseries{Accurate G-\/buffer normals}} off\+: \doxylink{namespace_unity}{Unity} stores values of normal vectors in the G-\/buffer in the RGB channel of a normal texture, 8 bit per value (x, y, z). The values are quantized with the loss of accuracy. This option increases performance, especially on mobile GPUs, but might lead to color banding artifacts on smooth surfaces.
\item {\bfseries{Accurate G-\/buffer normals}} on\+: \doxylink{namespace_unity}{Unity} uses the octahedron encoding to store values of normal vectors in the RGB channel of a normal texture. With this encoding, values of normal vectors are more accurate, but the encoding and decoding operations put extra load on the GPU.~\newline
The precision of the encoded normal vectors is similar to the precision of the sampled values in the Forward Rendering Path.
\end{DoxyItemize}

The following illustration shows the visual difference between the two options when the Camera is very close to the Game\+Object\+:



{\bfseries{Performance considerations}}

With {\bfseries{Accurate G-\/buffer normals}} option turned on, there is extra load on the GPU because of the encoding and decoding operations. This load is insignificant for desktop platforms and consoles, but might be considerable for mobile GPUs.

Turning the option on does not increase the memory footprint. To store the normals, \doxylink{namespace_unity}{Unity} uses the same RGB channel in the normal texture regardless of the encoding.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2435}{}\doxysubsection{\texorpdfstring{\label{_render-passes}%
Deferred Rendering Path render Passes}{\label{_render-passes}%
Deferred Rendering Path render Passes}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2435}
The following table shows the sequence of Render Pass events in the Deferred Rendering Path.

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Render Pass events }&\cellcolor{\tableheadbgcolor}\textbf{ Deferred Rendering Path Passes }&\cellcolor{\tableheadbgcolor}\textbf{ SSAO Renderer Feature Passes    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Render Pass events }&\cellcolor{\tableheadbgcolor}\textbf{ Deferred Rendering Path Passes }&\cellcolor{\tableheadbgcolor}\textbf{ SSAO Renderer Feature Passes    }\\\cline{1-3}
\endhead
Before\+Rendering &\&\#160; &\&\#160;  \\\cline{1-3}
Before\+Rendering\+Shadows &\&\#160; &\&\#160;  \\\cline{1-3}
After\+Rendering\+Shadows &\&\#160; &\&\#160;  \\\cline{1-3}
Before\+Rendering\+Pre\+Passes &Depth, or depth and normal prepass (Forward only materials) &\&\#160;  \\\cline{1-3}
After\+Rendering\+Pre\+Passes &\&\#160; &\&\#160;  \\\cline{1-3}
Before\+Rendering\+Gbuffer &G-\/buffer Pass (GBuffer\+Pass) &\&\#160;  \\\cline{1-3}
\&\#160; &Copy G-\/buffer depth texture &\&\#160;  \\\cline{1-3}
After\+Rendering\+Gbuffer &\&\#160; &SSAO (optional)  \\\cline{1-3}
Before\+Rendering\+Deferred\+Lights &\&\#160; &\multirow{4}{*}{  }\\\cline{1-2}
&Deferred rendering (stencil)  &\multicolumn{1}{c|}{}\\\cline{1-2}
After\+Rendering\+Deferred\+Lights &\&\#160;  &\multicolumn{1}{c|}{}\\\cline{1-2}
Before\+Rendering\+Opaques &Opaque Forward-\/only Materials  &\multicolumn{1}{c|}{}\\\cline{1-3}
After\+Rendering\+Opaques &\&\#160; &SSAO and blending (optional)  \\\cline{1-3}
Before\+Rendering\+Skybox &\&\#160; &\&\#160;  \\\cline{1-3}
After\+Rendering\+Skybox &\&\#160; &\&\#160;  \\\cline{1-3}
Before\+Rendering\+Transparents &\&\#160; &\&\#160;  \\\cline{1-3}
After\+Rendering\+Transparents &\&\#160; &\&\#160;  \\\cline{1-3}
Before\+Rendering\+Post\+Processing &\&\#160; &\&\#160;  \\\cline{1-3}
After\+Rendering\+Post\+Processing &\&\#160; &\&\#160;  \\\cline{1-3}
After\+Rendering &\&\#160; &\&\#160;   \\\cline{1-3}
\end{longtabu}


The following sections describe the Deferred Rendering Path render Passes.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2436}{}\doxysubsubsection{\texorpdfstring{Depth, or depth and normal prepass}{Depth, or depth and normal prepass}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2436}
In the Deferred Rendering Path, in the depth prepass or depth and normal prepass, \doxylink{namespace_unity}{Unity} renders only the Materials that do not support the deferred rendering model. For example, Materials using the Complex Lit shader are such Materials.

In the Deferred Rendering Path, \doxylink{namespace_unity}{Unity} does not use the depth prepass to generate a copy of the depth buffer (this behavior is different in the Forward Rendering Path).

If the Universal Renderer has the SSAO Renderer Feature, \doxylink{namespace_unity}{Unity} executes the depth and normal prepass. SSAO uses the screen-\/space depth and normal buffers to calculate ambient occlusion.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2437}{}\doxysubsubsection{\texorpdfstring{Optional passes\+: SSAO, SSAO with blending}{Optional passes\+: SSAO, SSAO with blending}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2437}
If the Universal Renderer has the SSAO Renderer Feature, and the {\bfseries{After Opaque}} option is disabled (the option is disabled by default), \doxylink{namespace_unity}{Unity} executes the SSAO Pass at the After\+Rendering\+Gbuffer event. The SSAO Renderer Feature calculates the SSAO texture. \doxylink{namespace_unity}{Unity} samples this texture in the Deferred rendering Pass and in the Pass that renders Forward-\/only Materials.

Using this Pass order, \doxylink{namespace_unity}{Unity} can combine the baked occlusion with the real-\/time occlusion from the SSAO Renderer Feature, and avoid double-\/darkening from the baked and the real-\/time ambient occlusion.

When the After Opaque option is enabled, \doxylink{namespace_unity}{Unity} executes the SSAO and blending Pass at the After\+Rendering\+Opaques event, after rendering the Forward-\/only Materials. \doxylink{namespace_unity}{Unity} then executes an extra full screen Pass to overlay the SSAO texture onto the Emissive/\+GI/\+Lighting buffer. This causes over-\/darkening of the areas that receive baked occlusion and real-\/time occlusion.

{\bfseries{Performance considerations}}

On mobile platforms with TBDR architecture, with the {\bfseries{After Opaque}} option is disabled, \doxylink{namespace_unity}{Unity} requires an extra render target for load and store operations. This has a significant performance impact.

Enabling the {\bfseries{After Opaque}} option on mobile platforms improves GPU performance. On mobile platforms with TBDR architecture, enabling this option avoids extra render target load and store operations.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2438}{}\doxysubsubsection{\texorpdfstring{Forward-\/only Pass}{Forward-\/only Pass}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2438}
Certain \doxylink{namespace_unity}{Unity} shaders use lighting models that \doxylink{namespace_unity}{Unity} cannot render in the Deferred Rendering Path.

Examples of such shaders\+:


\begin{DoxyItemize}
\item {\bfseries{Complex Lit}}\+: the Lighting model of this shader (for example, the Clear Coat effect) is too complex and extra Material properties cannot fit into the G-\/buffer.
\item {\bfseries{Baked Lit}} and {\bfseries{Unlit}}\+: these shaders do not calculate real-\/time lighting, that\textquotesingle{}s why \doxylink{namespace_unity}{Unity} renders them into the Emissive/\+GI/\+Lighting buffer directly during the Forward-\/only pass. This is faster than evaluating the shaders in the Deferred rendering (stencil) pass.
\item {\bfseries{Custom shaders}}\+: \doxylink{namespace_unity}{Unity} renders the shaders that do not declare the Pass tags required by the Deferred Rendering Path as Forward-\/only. The required Pass tags are\+: {\ttfamily Light\+Mode}, and {\ttfamily Universal\+Material\+Type}. For more information, see \doxysectlink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do3761fb4279bd2db7edff010440143af2}{URP Pass tags}{0}.
\end{DoxyItemize}

\doxylink{namespace_unity}{Unity} renders Materials with such shaders in the Forward Rendering Path. For the SSAO Renderer Feature to be able to calculate ambient occlusion for the Materials using the {\bfseries{Complex Lit}} shader, \doxylink{namespace_unity}{Unity} must render such Materials in the depth and normal prepass first. This is because \doxylink{namespace_unity}{Unity} does not render those Materials in the G-\/buffer pass (GBuffer\+Pass). For more information, see \doxysectlink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do3761fb4279bd2db7edff010440143af2}{URP Pass tags}{0}.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2439}{}\doxysubsubsection{\texorpdfstring{General implementation notes}{General implementation notes}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2439}
For maximum platform compatibility, the URP Deferred Rendering Path uses the light stencil volume technique to render light volumes and apply deferred shading.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2440}{}\doxysection{\texorpdfstring{Relevant code files}{Relevant code files}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2440}
This section contains the list of files that contain the code related to the Deferred Rendering Path.


\begin{DoxyItemize}
\item The main class that handles the Deferred Rendering Path\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{com.unity.render-\/pipelines.universal\(\backslash\)Runtime\(\backslash\)DeferredLights.cs}

\end{DoxyCode}

\item Scriptable\+Render\+Pass for the G-\/\+Buffer pass\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{com.unity.render-\/pipelines.universal\(\backslash\)Runtime\(\backslash\)Passes\(\backslash\)GBufferPass.cs}

\end{DoxyCode}

\item Scriptable\+Render\+Pass for the deferred shading pass\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{com.unity.render-\/pipelines.universal\(\backslash\)Runtime\(\backslash\)Passes\(\backslash\)DeferredPass.cs}

\end{DoxyCode}

\item Shader asset for the deferred shading\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{com.unity.render-\/pipelines.universal\(\backslash\)Shaders\(\backslash\)Utils\(\backslash\)StencilDeferred.shader}

\end{DoxyCode}

\item Utility functions for the deferred shading\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{com.unity.render-\/pipelines.universal\(\backslash\)Shaders\(\backslash\)Utils\(\backslash\)Deferred.hlsl}

\end{DoxyCode}

\item Utility functions for storing and loading the Material properties from the G-\/buffer\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{com.unity.render-\/pipelines.universal\(\backslash\)Shaders\(\backslash\)Utils\(\backslash\)UnityGBuffer.hlsl}

\end{DoxyCode}

\end{DoxyItemize}\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2441}{}\doxysection{\texorpdfstring{Shader\+Lab Pass tags}{Shader\+Lab Pass tags}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2441}
To enable \doxylink{namespace_unity}{Unity} to render a shader in the Deferred Rendering Path, the shader must have a Pass with the following tag definition\+:

{\ttfamily "{}\+Light\+Mode"{} = "{}\+Universal\+GBuffer"{}}

\doxylink{namespace_unity}{Unity} executes the shader with such {\ttfamily Light\+Mode} tag during the G-\/buffer Pass.

To indicate that \doxylink{namespace_unity}{Unity} must render a certain Material in the Forward-\/only Pass in the Deferred Rendering Path, add the following tags to a shader Pass\+:

{\ttfamily "{}\+Light\+Mode"{} = "{}\+Universal\+Forward\+Only"{}}

{\ttfamily "{}\+Light\+Mode"{} = "{}\+Depth\+Normals\+Only"{}}

To specify the shader lighting model (Lit, Simple\+Lit), use the {\ttfamily Universal\+Material\+Type} tag.

For more information, see the section \href{../urp-shaders/urp-shaderlab-pass-tags.md\#lightmode}{\texttt{ URP Pass tags\+: Light\+Mode}}.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2442}{}\doxysection{\texorpdfstring{Limitations and performance}{Limitations and performance}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2442}
This section describes the limitations of the Deferred Rendering Path.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2443}{}\doxysubsection{\texorpdfstring{Terrain blending}{Terrain blending}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2443}
When blending more than four Terrain layers, the Deferred Rendering Path generates slightly different results from the Forward Rendering Path. This happens because in the Forward Rendering Path, \doxylink{namespace_unity}{Unity} processes the first four layers separately from the next four layers using multi-\/pass rendering.

In the Forward Rendering Path, \doxylink{namespace_unity}{Unity} merges Material properties and calculates lighting for the combined properties of four layers at once. \doxylink{namespace_unity}{Unity} then processes the next four layers in the same way and alpha-\/blends the lighting results.

In the Deferred Rendering Path, \doxylink{namespace_unity}{Unity} combines Terrain layers in the G-\/buffer pass, four layers at a time, and then calculates lighting only once during the deferred rendering pass. This difference with the Forward Rendering Path leads to \doxylink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_terrain-visual-diff}{visually different outcomes}.

\doxylink{namespace_unity}{Unity} combines the Material properties in the G-\/buffer using hardware blending (four layers at a time), which limits how correct the combination of property values is. For example, pixel normals cannot be correctly combined using the alpha blend equation alone, because one Terrain layer might contain coarse Terrain detail while another layer might contain fine detail. Averaging or summing normals results in loss of accuracy.

\begin{quote}
{\bfseries{NOTE\+:}} Turning the setting Accurate G-\/buffer normals on breaks Terrain blending. With this setting turned on, \doxylink{namespace_unity}{Unity} encodes normals using octahedron encoding. Normals in different layers encoded this way cannot be blended together because of the bitwise nature of the encoding (2 x 12 bits). If your application requires more than four Terrain layers, turn the {\bfseries{Accurate G-\/buffer normals}} setting off. \end{quote}


\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_terrain-visual-diff}%
\Hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_terrain-visual-diff}%
The following illustration shows the visual difference when rendering Terrain layers with different Rendering Paths.

~\newline
{\itshape Terrain layers rendered with the Forward Rendering Path}

~\newline
{\itshape Terrain layers rendered with the Deferred Rendering Path}\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2444}{}\doxysubsection{\texorpdfstring{Baked Global Illumination and Lighting Modes}{Baked Global Illumination and Lighting Modes}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2444}
When Baked Global Illumination is enabled, the Subtractive and the Shadowmask Lighting modes put extra load on the GPU in the Deferred Rendering Path.

The Deferred Rendering Path supports the Subtractive and the Shadowmask Lighting modes for compatibility reasons, but, unlike the case with the Forward Rendering Path, these modes do not provide any improvements in performance. In the Deferred Rendering Path, \doxylink{namespace_unity}{Unity} processes all meshes using the same Lighting algorithm and stores the extra Lighting properties required by Subtractive and the Shadowmask modes in the Shadow\+Mask render target.

In the Deferred Rendering Path, the Baked Indirect Lighting mode provides better performance, since it does not require the Shadow\+Mask render target.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2445}{}\doxysubsection{\texorpdfstring{Rendering layers}{Rendering layers}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_do64065fd8e9b2943f9337d1c5115a3234_autotoc_md2445}
URP implements the Rendering Layers feature that lets you configure which Lights in a Scene affect specific meshes. Lights assigned to a specific Rendering Layer only affect the meshes assigned to the same Rendering Layer.

For more information on Rendering Layers, see the page \doxysectlink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_doa16a973ec50f62e886de4560e38cbeea}{Rendering Layers}{0}.

{\bfseries{Performance impact}}

The Rendering Layers feature requires an extra G-\/buffer render target to store the rendering layer mask (32 bits). The extra render target is likely to have a negative impact on GPU performance.

{\bfseries{Implementation notes}}

In the Forward Rendering Path, the \href{https://docs.unity3d.com/Manual/Layers.html}{\texttt{ Layers}} feature lets you tell \doxylink{namespace_unity}{Unity} to render specific meshes with a specific set of Lights. The \href{https://docs.unity3d.com/Manual/Layers.html}{\texttt{ Layers}} feature uses the culling mask system.

The Deferred Rendering Path cannot use the layer system with light culling masks, because the shading is deferred to a later stage in the rendering loop (see the {\bfseries{Deferred rendering (stencil)}} step in the Deferred Rendering Path render Passes table.) 