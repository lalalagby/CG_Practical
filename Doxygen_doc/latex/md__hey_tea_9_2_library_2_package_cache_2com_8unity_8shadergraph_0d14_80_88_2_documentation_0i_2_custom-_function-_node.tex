\chapter{Custom Function Node}
\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node}{}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node}\index{Custom Function Node@{Custom Function Node}}
\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3107}%
\Hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3107}%
 \hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3108}{}\doxysection{\texorpdfstring{Description}{Description}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3108}
The Custom Function Node enables you to inject your own custom HLSL code in Shader Graphs. This provides you with an extra level of control when you need it (for example, to do some fine-\/grained optimization). You can either write small functions directly into graphs by using the string mode, or reference external HLSL include files. Use the \doxysectlink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_port-_menu}{Custom Port Menu}{0} to define your own input and output ports on the node itself.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3109}{}\doxysection{\texorpdfstring{How to Use}{How to Use}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3109}
Use the \doxysectlink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_create-_node-_menu}{Create Node Menu}{0} to create Custom Function nodes. By default, new Custom Function nodes don\textquotesingle{}t have any input or output ports. In the \doxysectlink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_internal-_inspector}{Graph Inspector}{0}, open the {\bfseries{Node Settings}} to access the Custom Function and \doxysectlink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_port-_menu}{Custom Port Menu}{0} menus.

 \hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3110}{}\doxysubsection{\texorpdfstring{Custom Function menu}{Custom Function menu}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3110}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Menu Item   }&\cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Menu Item   }&\cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-2}
\endhead
Inputs   &A \doxysectlink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_port-_menu}{Custom Port Menu}{0} that defines the node\textquotesingle{}s input ports.    \\\cline{1-2}
Outputs   &A \doxysectlink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_port-_menu}{Custom Port Menu}{0} that defines the node\textquotesingle{}s input ports.    \\\cline{1-2}
Type   &A function type selector. Choose File to reference an external file or string to directly input functions to the node.    \\\cline{1-2}
Name   &Part of the name this custom function has in the final generated code. Suffixed by the function type {\ttfamily \+\_\+half} or {\ttfamily \+\_\+float}.    \\\cline{1-2}
Source   &An asset field to reference the external HLSL include file. {\bfseries{Only available in {\ttfamily File} mode}}.    \\\cline{1-2}
Body   &A text box where you enter HLSL code. {\bfseries{Only available in {\ttfamily String} mode}}.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3111}{}\doxysubsection{\texorpdfstring{Defining the Function via string}{Defining the Function via string}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3111}
If you select {\ttfamily String} mode, the graph generates the shader function. The {\ttfamily Name} field defines the name of the generated function, and the {\ttfamily Body} field defines the contents of the generated function. \doxylink{namespace_unity}{Unity} handles the arguments, braces, and indent scope automatically. In {\ttfamily String} mode you may use the token {\ttfamily \$precision} instead of {\ttfamily half} or {\ttfamily float} in the {\ttfamily Body} field. \doxylink{namespace_unity}{Unity} replaces this with the correct type, based on that node\textquotesingle{}s precision, when the node is processed.



The example in the image above generates the following function\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{void\ MyFunction\_float(float3\ A,\ float\ B,\ out\ float3\ Out)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ Out\ \ =\ \ A\ +\ B\ +\ 1/2;}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3112}{}\doxysubsection{\texorpdfstring{Defining the Function via file}{Defining the Function via file}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3112}
If you select {\ttfamily File} mode, the graph does not automatically generate the shader function. This mode injects an include reference in the final generated shader, and uses a function from within the referenced file. The {\ttfamily Name} field must match the name of the function you wish to call. The {\ttfamily Source} field contains a reference to the HLSL file that includes the function.



When you use {\ttfamily File} mode for the Custom Function node, you must manually format the functions properly. One thing to note when creating custom functions for Shader Graph is the precision suffixes. The generated code appends a precision suffix to function names. Your include file function must also append your desired precision suffix (shown below with {\ttfamily \+\_\+float}), or contain multiple functions with both {\ttfamily \+\_\+float} and {\ttfamily \+\_\+half} suffixes, but your {\ttfamily Name} field {\bfseries{must not include the precision suffix}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{//UNITY\_SHADER\_NO\_UPGRADE}
\DoxyCodeLine{\#ifndef\ MYHLSLINCLUDE\_INCLUDED}
\DoxyCodeLine{\#define\ MYHLSLINCLUDE\_INCLUDED}
\DoxyCodeLine{}
\DoxyCodeLine{void\ MyFunction\_float(float3\ A,\ float\ B,\ out\ float3\ Out)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ Out\ =\ A\ +\ B;}
\DoxyCodeLine{\}}
\DoxyCodeLine{\#endif\ //MYHLSLINCLUDE\_INCLUDED}

\end{DoxyCode}


{\ttfamily File} mode allows for more flexbility with custom functions in a graph. You can define uniform variables outside of the function scope, as shown here with a matrix.


\begin{DoxyCode}{0}
\DoxyCodeLine{//UNITY\_SHADER\_NO\_UPGRADE}
\DoxyCodeLine{\#ifndef\ MYHLSLINCLUDE\_INCLUDED}
\DoxyCodeLine{\#define\ MYHLSLINCLUDE\_INCLUDED}
\DoxyCodeLine{float4x4\ \_MyMatrix;}
\DoxyCodeLine{void\ MyFunction\_float(float3\ A,\ float\ B,\ out\ float3\ Out)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ A\ =\ mul(float4(A,\ 0.0),\ \_MyMatrix).rgb;}
\DoxyCodeLine{Out\ =\ A\ +\ B;}
\DoxyCodeLine{\}}
\DoxyCodeLine{\#endif\ //MYHLSLINCLUDE\_INCLUDED}

\end{DoxyCode}


You can define multiple functions in the same file, and call them from your referenced function. Alternatively, you can reference the same file, but use different functions from different Custom Function nodes.


\begin{DoxyCode}{0}
\DoxyCodeLine{//UNITY\_SHADER\_NO\_UPGRADE}
\DoxyCodeLine{\#ifndef\ MYHLSLINCLUDE\_INCLUDED}
\DoxyCodeLine{\#define\ MYHLSLINCLUDE\_INCLUDED}
\DoxyCodeLine{float3\ MyOtherFunction\_float(float3\ In)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ return\ In\ *\ In;}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{void\ MyFunction\_float(float3\ A,\ float\ B,\ out\ float3\ Out)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ A\ =\ MyOtherFunction\_float(A);}
\DoxyCodeLine{\ \ \ \ Out\ =\ A\ +\ B;}
\DoxyCodeLine{\}}
\DoxyCodeLine{\#endif\ //MYHLSLINCLUDE\_INCLUDED}

\end{DoxyCode}


You can even include other files that contain other functions.


\begin{DoxyCode}{0}
\DoxyCodeLine{//UNITY\_SHADER\_NO\_UPGRADE}
\DoxyCodeLine{\#ifndef\ MYHLSLINCLUDE\_INCLUDED}
\DoxyCodeLine{\#define\ MYHLSLINCLUDE\_INCLUDED}
\DoxyCodeLine{\#include\ "{}Assets/MyOtherInclude.hlsl"{}}
\DoxyCodeLine{void\ MyFunction\_float(float3\ A,\ float\ B,\ out\ float3\ Out)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ A\ =\ MyOtherFunction\_float(A);}
\DoxyCodeLine{\ \ \ \ Out\ =\ A\ +\ B;}
\DoxyCodeLine{\}}
\DoxyCodeLine{\#endif\ //MYHLSLINCLUDE\_INCLUDED}

\end{DoxyCode}
\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3113}{}\doxysubsection{\texorpdfstring{Reusing Custom Function Nodes}{Reusing Custom Function Nodes}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3113}
The Custom Function node, on its own, is a single node instance. If you wish to re-\/use the same custom functions without re-\/creating the inputs, outputs, and function referencing, use \doxysectlink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_sub-graph}{Sub Graphs}{0}. Sub Graphs appear in the \doxysectlink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_create-_node-_menu}{Create Node Menu}{0}, and they enable you to share or re-\/use your custom functions.



Create your custom function either directly in a Sub Graph, or right-\/click the existing Custom Function node and select {\ttfamily Convert to Sub Graph}. To add the appropriate input and output ports, use the \doxysectlink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_internal-_inspector}{Graph Inspector}{0} and \doxysectlink{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_port-_menu}{Custom Port Menu}{0}. After this, you can reuse your custom function as many times as needed, even within other Sub Graphs.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3114}{}\doxysubsection{\texorpdfstring{Working with texture wires}{Working with texture wires}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3114}
From version 10.\+3, Shader Graph has five new data structures to ensure that Custom Function Nodes (CFNs) and Sub\+Graphs input and output data from texture wires in a consistent way. The new structures also make it possible for Sampler\+State to compile on \href{https://en.wikipedia.org/wiki/OpenGL_ES\#OpenGL_ES_2.0}{\texttt{ GLES2}} platforms and access data associated with textures via {\ttfamily my\+Input\+Tex.\+samplerstate} and {\ttfamily my\+Input\+Tex.\+texel\+Size}.

Four structures are for the texture types, and one is for the sampler state\+:
\begin{DoxyItemize}
\item Unity\+Texture2D
\item Unity\+Texture2\+DArray
\item Unity\+Texture3D
\item Unity\+Texture\+Cube
\item Unity\+Sampler\+State
\end{DoxyItemize}

CFNs you create with earlier versions of Shader Graph continue to work after this change. As part of the automatic update, \doxylink{namespace_unity}{Unity} transitions them to the new {\bfseries{Bare}} node type. This type replicates the old input and output behavior. All other types pass the new structs.

However, you should manually upgrade CFNs that produce texture or samplerstate types as output to ensure that they behave consistently—and to gain the benefits of the new design. \doxylink{namespace_unity}{Unity} flags this type of outdated Custom Function Nodes with a warning when you open your Shader Graph in 10.\+3 or later.\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3115}{}\doxysubsubsection{\texorpdfstring{How to upgrade}{How to upgrade}}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8shadergraph_0d14_80_88_2_documentation_0i_2_custom-_function-_node_autotoc_md3115}

\begin{DoxyEnumerate}
\item Change all of the input and output types from {\bfseries{Bare}} to {\bfseries{non-\/\+Bare}}.~\newline

\end{DoxyEnumerate}
\begin{DoxyItemize}
\item {\bfseries{String}} type\+: Ensure that your HLSL string already uses \doxylink{namespace_unity}{Unity}\textquotesingle{}s texture access macros (such as {\ttfamily SAMPLE\+\_\+\+TEXTURE2D}).
\item {\bfseries{File}} type\+: Replace Bare types (such as Texture2D) with the new struct types (such as Unity\+Texture2D) in your function parameters.
\end{DoxyItemize}
\begin{DoxyEnumerate}
\item If your HLSL code is using platform-\/specific or non-\/standard texture operations, you\textquotesingle{}ll need to convert the way you access textures to take that structure into account. For example, {\ttfamily my\+Input\+Tex.\+Get\+Dimensions(...)} would become {\ttfamily my\+Input\+Tex.\+tex.\+Get\+Dimensions(...)}
\end{DoxyEnumerate}

From version 10.\+3, you can access data associated with textures via {\ttfamily my\+Input\+Tex.\+samplerstate} and {\ttfamily my\+Input\+Tex.\+texel\+Size}. 