\chapter{Skip\+Locals\+Init attribute}
\hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8burst_0d1_88_87_2_documentation_0i_2optimization-skiplocalsinit}{}\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8burst_0d1_88_87_2_documentation_0i_2optimization-skiplocalsinit}\index{SkipLocalsInit attribute@{SkipLocalsInit attribute}}
\label{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8burst_0d1_88_87_2_documentation_0i_2optimization-skiplocalsinit_autotoc_md427}%
\Hypertarget{md__hey_tea_9_2_library_2_package_cache_2com_8unity_8burst_0d1_88_87_2_documentation_0i_2optimization-skiplocalsinit_autotoc_md427}%
 Use \href{xref:Unity.Burst.CompilerServices.SkipLocalsInitAttribute}{\texttt{ {\ttfamily Skip\+Locals\+Init\+Attribute}}}, to tell \doxylink{namespace_burst}{Burst} that any stack allocations within a method don\textquotesingle{}t have to be initialized to zero.

In C\# all local variables are initialized to zero by default. This is useful because it means an entire class of bugs surrounding undefined data disappears. But this can impact runtime performance, because initializing this data to zero takes work\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\ \#}}
\DoxyCodeLine{\textcolor{keyword}{static}\ unsafe\ \textcolor{keywordtype}{int}\ DoSomethingWithLUT(\textcolor{keywordtype}{int}*\ data);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{static}\ unsafe\ \textcolor{keywordtype}{int}\ DoSomething(\textcolor{keywordtype}{int}\ size)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{int}*\ data\ =\ stackalloc\ \textcolor{keywordtype}{int}[size];}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Initialize\ every\ field\ of\ data\ to\ be\ an\ incrementing\ set\ of\ values.}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ size;\ i++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ data[i]\ =\ i;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Use\ the\ data\ elsewhere.}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ DoSomethingWithLUT(data);}
\DoxyCodeLine{\}}

\end{DoxyCode}


The X86 assembly for this is\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\ 86asm}
\DoxyCodeLine{\ \ \ \ \ \ \ \ push\ \ \ \ rbp}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .seh\_pushreg\ rbp}
\DoxyCodeLine{\ \ \ \ \ \ \ \ push\ \ \ \ rsi}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .seh\_pushreg\ rsi}
\DoxyCodeLine{\ \ \ \ \ \ \ \ push\ \ \ \ rdi}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .seh\_pushreg\ rdi}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ rbp,\ rsp}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .seh\_setframe\ rbp,\ 0}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .seh\_endprologue}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ edi,\ ecx}
\DoxyCodeLine{\ \ \ \ \ \ \ \ lea\ \ \ \ \ r8d,\ [4*rdi]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ lea\ \ \ \ \ rax,\ [r8\ +\ 15]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ and\ \ \ \ \ rax,\ -\/16}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movabs\ \ r11,\ offset\ \_\_chkstk}
\DoxyCodeLine{\ \ \ \ \ \ \ \ call\ \ \ \ r11}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sub\ \ \ \ \ rsp,\ rax}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ rsi,\ rsp}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sub\ \ \ \ \ rsp,\ 32}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movabs\ \ rax,\ offset\ burst.memset.inline.X64\_SSE4.i32@@32}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ rcx,\ rsi}
\DoxyCodeLine{\ \ \ \ \ \ \ \ xor\ \ \ \ \ edx,\ edx}
\DoxyCodeLine{\ \ \ \ \ \ \ \ xor\ \ \ \ \ r9d,\ r9d}
\DoxyCodeLine{\ \ \ \ \ \ \ \ call\ \ \ \ rax}
\DoxyCodeLine{\ \ \ \ \ \ \ \ add\ \ \ \ \ rsp,\ 32}
\DoxyCodeLine{\ \ \ \ \ \ \ \ test\ \ \ \ edi,\ edi}
\DoxyCodeLine{\ \ \ \ \ \ \ \ jle\ \ \ \ \ .LBB0\_7}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ eax,\ edi}
\DoxyCodeLine{\ \ \ \ \ \ \ \ cmp\ \ \ \ \ edi,\ 8}
\DoxyCodeLine{\ \ \ \ \ \ \ \ jae\ \ \ \ \ .LBB0\_3}
\DoxyCodeLine{\ \ \ \ \ \ \ \ xor\ \ \ \ \ ecx,\ ecx}
\DoxyCodeLine{\ \ \ \ \ \ \ \ jmp\ \ \ \ \ .LBB0\_6}
\DoxyCodeLine{.LBB0\_3:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ ecx,\ eax}
\DoxyCodeLine{\ \ \ \ \ \ \ \ and\ \ \ \ \ ecx,\ -\/8}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movabs\ \ rdx,\ offset\ \_\_xmm@00000003000000020000000100000000}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movdqa\ \ xmm0,\ xmmword\ ptr\ [rdx]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ rdx,\ rsi}
\DoxyCodeLine{\ \ \ \ \ \ \ \ add\ \ \ \ \ rdx,\ 16}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movabs\ \ rdi,\ offset\ \_\_xmm@00000004000000040000000400000004}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movdqa\ \ xmm1,\ xmmword\ ptr\ [rdi]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movabs\ \ rdi,\ offset\ \_\_xmm@00000008000000080000000800000008}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movdqa\ \ xmm2,\ xmmword\ ptr\ [rdi]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ rdi,\ rcx}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .p2align\ \ \ \ \ \ \ \ 4,\ 0x90}
\DoxyCodeLine{.LBB0\_4:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movdqa\ \ xmm3,\ xmm0}
\DoxyCodeLine{\ \ \ \ \ \ \ \ paddd\ \ \ xmm3,\ xmm1}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movdqu\ \ xmmword\ ptr\ [rdx\ -\/\ 16],\ xmm0}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movdqu\ \ xmmword\ ptr\ [rdx],\ xmm3}
\DoxyCodeLine{\ \ \ \ \ \ \ \ paddd\ \ \ xmm0,\ xmm2}
\DoxyCodeLine{\ \ \ \ \ \ \ \ add\ \ \ \ \ rdx,\ 32}
\DoxyCodeLine{\ \ \ \ \ \ \ \ add\ \ \ \ \ rdi,\ -\/8}
\DoxyCodeLine{\ \ \ \ \ \ \ \ jne\ \ \ \ \ .LBB0\_4}
\DoxyCodeLine{\ \ \ \ \ \ \ \ cmp\ \ \ \ \ rcx,\ rax}
\DoxyCodeLine{\ \ \ \ \ \ \ \ je\ \ \ \ \ \ .LBB0\_7}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .p2align\ \ \ \ \ \ \ \ 4,\ 0x90}
\DoxyCodeLine{.LBB0\_6:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ dword\ ptr\ [rsi\ +\ 4*rcx],\ ecx}
\DoxyCodeLine{\ \ \ \ \ \ \ \ inc\ \ \ \ \ rcx}
\DoxyCodeLine{\ \ \ \ \ \ \ \ cmp\ \ \ \ \ rax,\ rcx}
\DoxyCodeLine{\ \ \ \ \ \ \ \ jne\ \ \ \ \ .LBB0\_6}
\DoxyCodeLine{.LBB0\_7:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sub\ \ \ \ \ rsp,\ 32}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movabs\ \ rax,\ offset\ "{}DoSomethingWithLUT"{}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ rcx,\ rsi}
\DoxyCodeLine{\ \ \ \ \ \ \ \ call\ \ \ \ rax}
\DoxyCodeLine{\ \ \ \ \ \ \ \ nop}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ rsp,\ rbp}
\DoxyCodeLine{\ \ \ \ \ \ \ \ pop\ \ \ \ \ rdi}
\DoxyCodeLine{\ \ \ \ \ \ \ \ pop\ \ \ \ \ rsi}
\DoxyCodeLine{\ \ \ \ \ \ \ \ pop\ \ \ \ \ rbp}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ret}

\end{DoxyCode}


In this example, the {\ttfamily movabs rax, offset burst.\+memset.\+inline.\+X64\+\_\+\+SSE4.\+i32@@32} line means that you\textquotesingle{}ve had to inject a memset to zero out the data. In the above example, you know that the array is entirely initialized in the following loop, but \doxylink{namespace_burst}{Burst} doesn\textquotesingle{}t know that.

To fix this problem, use \href{xref:Unity.Burst.CompilerServices.SkipLocalsInitAttribute}{\texttt{ {\ttfamily Unity.\+Burst.\+Compiler\+Services.\+Skip\+Locals\+Init\+Attribute}}}, which tells \doxylink{namespace_burst}{Burst} that any stack allocations within a method don\textquotesingle{}t have to be initialized to zero.

\texorpdfstring{$>$}{>}\mbox{[}!\+NOTE\mbox{]} \texorpdfstring{$>$}{>}Only use this attribute if you\textquotesingle{}re certain that you won\textquotesingle{}t run into undefined behavior bugs.

For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\ \#}}
\DoxyCodeLine{\textcolor{keyword}{using\ }Unity.Burst.CompilerServices;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{static}\ unsafe\ \textcolor{keywordtype}{int}\ DoSomethingWithLUT(\textcolor{keywordtype}{int}*\ data);}
\DoxyCodeLine{}
\DoxyCodeLine{[SkipLocalsInit]}
\DoxyCodeLine{\textcolor{keyword}{static}\ unsafe\ \textcolor{keywordtype}{int}\ DoSomething(\textcolor{keywordtype}{int}\ size)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{int}*\ data\ =\ stackalloc\ \textcolor{keywordtype}{int}[size];}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Initialize\ every\ field\ of\ data\ to\ be\ an\ incrementing\ set\ of\ values.}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ size;\ i++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ data[i]\ =\ i;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Use\ the\ data\ elsewhere.}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ DoSomethingWithLUT(data);}
\DoxyCodeLine{\}}

\end{DoxyCode}


The assembly after adding the {\ttfamily \mbox{[}Skip\+Locals\+Init\mbox{]}} on the method is\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\ 86asm}
\DoxyCodeLine{\ \ \ \ \ \ \ \ push\ \ \ \ rbp}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .seh\_pushreg\ rbp}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ rbp,\ rsp}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .seh\_setframe\ rbp,\ 0}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .seh\_endprologue}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ edx,\ ecx}
\DoxyCodeLine{\ \ \ \ \ \ \ \ lea\ \ \ \ \ eax,\ [4*rdx]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ add\ \ \ \ \ rax,\ 15}
\DoxyCodeLine{\ \ \ \ \ \ \ \ and\ \ \ \ \ rax,\ -\/16}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movabs\ \ r11,\ offset\ \_\_chkstk}
\DoxyCodeLine{\ \ \ \ \ \ \ \ call\ \ \ \ r11}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sub\ \ \ \ \ rsp,\ rax}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ rcx,\ rsp}
\DoxyCodeLine{\ \ \ \ \ \ \ \ test\ \ \ \ edx,\ edx}
\DoxyCodeLine{\ \ \ \ \ \ \ \ jle\ \ \ \ \ .LBB0\_7}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ r8d,\ edx}
\DoxyCodeLine{\ \ \ \ \ \ \ \ cmp\ \ \ \ \ edx,\ 8}
\DoxyCodeLine{\ \ \ \ \ \ \ \ jae\ \ \ \ \ .LBB0\_3}
\DoxyCodeLine{\ \ \ \ \ \ \ \ xor\ \ \ \ \ r10d,\ r10d}
\DoxyCodeLine{\ \ \ \ \ \ \ \ jmp\ \ \ \ \ .LBB0\_6}
\DoxyCodeLine{.LBB0\_3:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ r10d,\ r8d}
\DoxyCodeLine{\ \ \ \ \ \ \ \ and\ \ \ \ \ r10d,\ -\/8}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movabs\ \ rax,\ offset\ \_\_xmm@00000003000000020000000100000000}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movdqa\ \ xmm0,\ xmmword\ ptr\ [rax]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ rax,\ rcx}
\DoxyCodeLine{\ \ \ \ \ \ \ \ add\ \ \ \ \ rax,\ 16}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movabs\ \ rdx,\ offset\ \_\_xmm@00000004000000040000000400000004}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movdqa\ \ xmm1,\ xmmword\ ptr\ [rdx]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movabs\ \ rdx,\ offset\ \_\_xmm@00000008000000080000000800000008}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movdqa\ \ xmm2,\ xmmword\ ptr\ [rdx]}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ r9,\ r10}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .p2align\ \ \ \ \ \ \ \ 4,\ 0x90}
\DoxyCodeLine{.LBB0\_4:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movdqa\ \ xmm3,\ xmm0}
\DoxyCodeLine{\ \ \ \ \ \ \ \ paddd\ \ \ xmm3,\ xmm1}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movdqu\ \ xmmword\ ptr\ [rax\ -\/\ 16],\ xmm0}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movdqu\ \ xmmword\ ptr\ [rax],\ xmm3}
\DoxyCodeLine{\ \ \ \ \ \ \ \ paddd\ \ \ xmm0,\ xmm2}
\DoxyCodeLine{\ \ \ \ \ \ \ \ add\ \ \ \ \ rax,\ 32}
\DoxyCodeLine{\ \ \ \ \ \ \ \ add\ \ \ \ \ r9,\ -\/8}
\DoxyCodeLine{\ \ \ \ \ \ \ \ jne\ \ \ \ \ .LBB0\_4}
\DoxyCodeLine{\ \ \ \ \ \ \ \ cmp\ \ \ \ \ r10,\ r8}
\DoxyCodeLine{\ \ \ \ \ \ \ \ je\ \ \ \ \ \ .LBB0\_7}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .p2align\ \ \ \ \ \ \ \ 4,\ 0x90}
\DoxyCodeLine{.LBB0\_6:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ dword\ ptr\ [rcx\ +\ 4*r10],\ r10d}
\DoxyCodeLine{\ \ \ \ \ \ \ \ inc\ \ \ \ \ r10}
\DoxyCodeLine{\ \ \ \ \ \ \ \ cmp\ \ \ \ \ r8,\ r10}
\DoxyCodeLine{\ \ \ \ \ \ \ \ jne\ \ \ \ \ .LBB0\_6}
\DoxyCodeLine{.LBB0\_7:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ sub\ \ \ \ \ rsp,\ 32}
\DoxyCodeLine{\ \ \ \ \ \ \ \ movabs\ \ rax,\ offset\ "{}DoSomethingWithLUT"{}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ call\ \ \ \ rax}
\DoxyCodeLine{\ \ \ \ \ \ \ \ nop}
\DoxyCodeLine{\ \ \ \ \ \ \ \ mov\ \ \ \ \ rsp,\ rbp}
\DoxyCodeLine{\ \ \ \ \ \ \ \ pop\ \ \ \ \ rbp}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ret}

\end{DoxyCode}


The call to memset is now gone, because you\textquotesingle{}ve told \doxylink{namespace_burst}{Burst} that any stack allocations within a method don\textquotesingle{}t have to be initialized to zero. 