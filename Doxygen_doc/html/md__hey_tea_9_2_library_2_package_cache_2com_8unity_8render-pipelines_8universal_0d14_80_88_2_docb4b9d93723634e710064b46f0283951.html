<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: How to create a custom Renderer Feature</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">How to create a custom Renderer Feature</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2397"></a> This section describes how to create a custom Renderer Feature for a URP Renderer.</p>
<p>This section assumes the following:</p>
<ul>
<li>The <b>Scriptable Render Pipeline Settings</b> property refers to a URP asset (<b>Project Settings</b> &gt; <b><a class="el" href="namespace_graphics.html">Graphics</a></b> &gt; <b>Scriptable Render Pipeline Settings</b>).</li>
</ul>
<p>This article contains the following sections:</p>
<ul>
<li>Create example Scene and GameObjects.</li>
<li>Create a scriptable Renderer Feature and add it to the Universal Renderer.</li>
<li>Create and enqueue the scriptable Render Pass.</li>
<li>Implement rendering commands in the Execute method.</li>
<li>Implement the example-specific Material and rendering code.</li>
<li>Change the order of the render passes</li>
<li>Complete code for this example</li>
</ul>
<h1><a class="anchor" id="autotoc_md2398"></a>
<a class="anchor" id="example-scene"></a>Create example Scene and GameObjects</h1>
<p>To follow the steps in this section, create a new Scene with the following GameObjects:</p>
<ol type="1">
<li>Create a plane.</li>
<li>Create a new Material and assign it the <code>Universal Render Pipeline/Lit</code> shader. Set the base color to grey (for example, <code>#6A6A6A</code>). Call the Material <code>Plane</code>.</li>
<li>Create a Point Light and place it above the plane.</li>
</ol>
<p>Your Scene should look like the following illustration:</p>
<p><img src="../Images/customizing-urp/custom-renderer-feature/sample-scene.png" alt="Example Scene" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md2399"></a>
<a class="anchor" id="scriptable-renderer-feature"></a>Create a scriptable Renderer Feature and add it to the Universal Renderer</h1>
<p>This part shows how to create a scriptable Renderer Feature and implement the methods that let you configure and inject <code>ScriptableRenderPass</code> instances into the scriptable Renderer.</p>
<ol type="1">
<li>Create a new C# script. Call the script <code>LensFlareRendererFeature.cs</code>.</li>
<li><p class="startli">Open the script, remove all the code from the <code>LensFlareRendererFeature</code> class that <a class="el" href="namespace_unity.html">Unity</a> created. Add the following <code>using</code> directive.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">using </span>UnityEngine.Rendering.Universal;</div>
</div><!-- fragment --></li>
<li><p class="startli">The <code>LensFlareRendererFeature</code> class must inherit from the <code>ScriptableRendererFeature</code> class.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">class </span>LensFlareRendererFeature : <a class="code hl_class" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer_feature.html">ScriptableRendererFeature</a></div>
<div class="ttc" id="aclass_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer_feature_html"><div class="ttname"><a href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer_feature.html">UnityEngine.Rendering.Universal.ScriptableRendererFeature</a></div><div class="ttdoc">You can add a ScriptableRendererFeature to the ScriptableRenderer. Use this scriptable renderer featu...</div><div class="ttdef"><b>Definition</b> ScriptableRendererFeature.cs:13</div></div>
</div><!-- fragment --></li>
<li>The class must implement the following methods:<ul>
<li><code>Create</code>: <a class="el" href="namespace_unity.html">Unity</a> calls this method on the following events:<ul>
<li>When the Renderer Feature loads the first time.</li>
<li>When you enable or disable the Renderer Feature.</li>
<li>When you change a property in the inspector of the Renderer Feature.</li>
</ul>
</li>
<li><code>AddRenderPasses</code>: <a class="el" href="namespace_unity.html">Unity</a> calls this method every frame, once for each Camera. This method lets you inject <code>ScriptableRenderPass</code> instances into the scriptable Renderer.</li>
</ul>
</li>
</ol>
<p>Now you have the custom <code>LensFlareRendererFeature</code> Renderer Feature with its main methods.</p>
<p>Below is the complete code for this part.</p>
<div class="fragment"><div class="line"><span class="preprocessor"> #</span></div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_unity_engine.html">UnityEngine</a>;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering.Universal;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>LensFlareRendererFeature : <a class="code hl_class" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer_feature.html">ScriptableRendererFeature</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Create()</div>
<div class="line">    { }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> AddRenderPasses(<a class="code hl_class" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer.html">ScriptableRenderer</a> renderer,</div>
<div class="line">    ref <a class="code hl_struct" href="struct_unity_engine_1_1_rendering_1_1_universal_1_1_rendering_data.html">RenderingData</a> renderingData)</div>
<div class="line">    { }</div>
<div class="line">}</div>
<div class="ttc" id="aclass_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer_html"><div class="ttname"><a href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer.html">UnityEngine.Rendering.Universal.ScriptableRenderer</a></div><div class="ttdoc">Class ScriptableRenderer implements a rendering strategy. It describes how culling and lighting works...</div><div class="ttdef"><b>Definition</b> ScriptableRenderer.cs:26</div></div>
<div class="ttc" id="anamespace_unity_engine_html"><div class="ttname"><a href="namespace_unity_engine.html">UnityEngine</a></div><div class="ttdef"><b>Definition</b> IGL.cs:2</div></div>
<div class="ttc" id="astruct_unity_engine_1_1_rendering_1_1_universal_1_1_rendering_data_html"><div class="ttname"><a href="struct_unity_engine_1_1_rendering_1_1_universal_1_1_rendering_data.html">UnityEngine.Rendering.Universal.RenderingData</a></div><div class="ttdoc">Struct that flattens several rendering settings used to render a camera stack. URP builds the Renderi...</div><div class="ttdef"><b>Definition</b> UniversalRenderPipelineCore.cs:85</div></div>
</div><!-- fragment --><p>Add the Renderer Feature you created to the the Universal Renderer asset. <a class="el" href="md__hey_tea_9_2_library_2_package_cache_2com_8unity_8render-pipelines_8universal_0d14_80_88_2_dobad63f519f0fde26755d12ecfe7020ca.html">Follow this link to read how to add a Renderer Feature to a Renderer</a>.</p>
<p><img src="../Images/customizing-urp/custom-renderer-feature/add-new-renderer-feature.png" alt="Add the Lens Flare Renderer Feature to the Universal Renderer." class="inline"/><br  />
<em>Add the Lens Flare Renderer Feature to the Universal Renderer.</em></p>
<h1><a class="anchor" id="autotoc_md2400"></a>
<a class="anchor" id="scriptable-render-pass"></a>Create and enqueue the scriptable Render Pass</h1>
<p>This part shows how to create a scriptable Render Pass and and enqueue its instance into the scriptable Renderer.</p>
<ol type="1">
<li><p class="startli">In the <code>LensFlareRendererFeature</code> class, declare the <code>LensFlarePass</code> class that inherits from <code>ScriptableRenderPass</code>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">class </span>LensFlarePass : <a class="code hl_class" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_render_pass.html">ScriptableRenderPass</a></div>
<div class="line">   { }</div>
<div class="ttc" id="aclass_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_render_pass_html"><div class="ttname"><a href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_render_pass.html">UnityEngine.Rendering.Universal.ScriptableRenderPass</a></div><div class="ttdoc">ScriptableRenderPass implements a logical rendering pass that can be used to extend Universal RP rend...</div><div class="ttdef"><b>Definition</b> ScriptableRenderPass.cs:174</div></div>
</div><!-- fragment --></li>
<li><p class="startli">In <code>LensFlarePass</code>, add the <code>Execute</code> method.</p>
<p class="startli"><a class="el" href="namespace_unity.html">Unity</a> runs the <code>Execute</code> method every frame. In this method, you can implement your custom rendering functionality.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Execute(ScriptableRenderContext context,</div>
<div class="line">   ref <a class="code hl_struct" href="struct_unity_engine_1_1_rendering_1_1_universal_1_1_rendering_data.html">RenderingData</a> renderingData)</div>
<div class="line">   { }</div>
</div><!-- fragment --></li>
<li><p class="startli">In the <code>LensFlareRendererFeature</code> class, declare a private <code>LensFlarePass</code> field.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">private</span> LensFlarePass _lensFlarePass;</div>
</div><!-- fragment --></li>
<li><p class="startli">In the <code>Create</code> method, instantiate the <code>_lensFlarePass</code> object:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   _lensFlarePass = <span class="keyword">new</span> LensFlarePass(FlareSettings);</div>
</div><!-- fragment --></li>
<li><p class="startli">In the <code>AddRenderPasses</code> method, use the <code>EnqueuePass</code> method of the <code>renderer</code> object to enqueue <code>_lensFlarePass</code> in the rendering queue.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   renderer.EnqueuePass(_lensFlarePass);</div>
</div><!-- fragment --></li>
</ol>
<p>Now your custom <code>LensFlareRendererFeature</code> Renderer Feature is executing the <code>Execute</code> method inside the custom <code>LensFlarePass</code> pass.</p>
<p>Below is the complete code for this part.</p>
<div class="fragment"><div class="line"><span class="preprocessor"> #</span></div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_unity_engine.html">UnityEngine</a>;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering.Universal;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>LensFlareRendererFeature : <a class="code hl_class" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer_feature.html">ScriptableRendererFeature</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">class </span>LensFlarePass : <a class="code hl_class" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_render_pass.html">ScriptableRenderPass</a></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Execute(ScriptableRenderContext context, ref <a class="code hl_struct" href="struct_unity_engine_1_1_rendering_1_1_universal_1_1_rendering_data.html">RenderingData</a> renderingData)</div>
<div class="line">        {</div>
<div class="line">            Debug.Log(message: <span class="stringliteral">&quot;The Execute() method runs.&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> LensFlarePass _lensFlarePass;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Create()</div>
<div class="line">    {</div>
<div class="line">        _lensFlarePass = <span class="keyword">new</span> LensFlarePass();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> AddRenderPasses(<a class="code hl_class" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer.html">ScriptableRenderer</a> renderer, ref <a class="code hl_struct" href="struct_unity_engine_1_1_rendering_1_1_universal_1_1_rendering_data.html">RenderingData</a> renderingData)</div>
<div class="line">    {</div>
<div class="line">        renderer.<a class="code hl_function" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer.html#adef70d792e8e83c7feab314db83b02f2">EnqueuePass</a>(_lensFlarePass);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclass_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer_html_adef70d792e8e83c7feab314db83b02f2"><div class="ttname"><a href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer.html#adef70d792e8e83c7feab314db83b02f2">UnityEngine.Rendering.Universal.ScriptableRenderer.EnqueuePass</a></div><div class="ttdeci">void EnqueuePass(ScriptableRenderPass pass)</div><div class="ttdoc">Enqueues a render pass for execution.</div><div class="ttdef"><b>Definition</b> ScriptableRenderer.cs:1277</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2401"></a>
<a class="anchor" id="execute-method"></a>Implement rendering commands in the Execute method</h1>
<p>This part shows how to implement custom logic in the Execute method.</p>
<ol type="1">
<li><p class="startli">Create a <a href="https://docs.unity3d.com/2021.2/Documentation/ScriptReference/Rendering.CommandBuffer.html">CommandBuffer</a> type object. This object holds the list of rendering commands to execute.</p>
<p class="startli">In the <code>Execute</code> method, add the following line:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   CommandBuffer cmd = CommandBufferPool.Get(name: <span class="stringliteral">&quot;LensFlarePass&quot;</span>);</div>
</div><!-- fragment --><p class="startli">The method <code>CommandBufferPool.Get(name: "LensFlarePass")</code> gets the new command buffer and assigns a name to it.</p>
</li>
<li><p class="startli">Add the line that executes the command buffer and the line that releases it.</p>
<p class="startli">In the <code>Execute</code> method, add the following lines after the command buffer declaration:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   context.ExecuteCommandBuffer(cmd);</div>
<div class="line">   CommandBufferPool.Release(cmd);</div>
</div><!-- fragment --><p class="startli">Now the boilerplate part is ready and we can proceed to implementing the custom rendering logic.</p>
</li>
</ol>
<p>The following steps implement the custom rendering logic.</p>
<p>In this example, the Renderer Feature draws lens flares as a texture on a Quad. The implementation requires a Material and a mesh (Quad).</p>
<ol type="1">
<li><p class="startli">In the <code>LensFlarePass</code> class, declare two private fields: <code>Material</code> and <code>Mesh</code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">private</span> Material _material;</div>
<div class="line">   <span class="keyword">private</span> Mesh _mesh;</div>
</div><!-- fragment --><p class="startli">Then declare the constructor that takes those variables as arguments:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">public</span> LensFlarePass(Material material, Mesh mesh)</div>
<div class="line">   {</div>
<div class="line">       _material = material;</div>
<div class="line">       _mesh = mesh;</div>
<div class="line">   }</div>
</div><!-- fragment --></li>
<li><p class="startli">Now the <code>LensFlarePass</code> class expects two arguments. To initialize the class with the arguments, add the following public fields in the <code>LensFlareRendererFeature</code> class:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keyword">public</span> Material material;</div>
<div class="line">   <span class="keyword">public</span> Mesh mesh;</div>
</div><!-- fragment --><p class="startli">And add the arguments to the <code>LensFlarePass</code> declaration in the <code>Create</code> method:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   _lensFlarePass = <span class="keyword">new</span> LensFlarePass(material, mesh);</div>
</div><!-- fragment --></li>
<li><p class="startli">In the <code>Execute</code> method, use the <code>DrawMesh</code> method of the <code>cmd</code> object. The method takes the <code>_material</code> and the <code>_mesh</code> fields as arguments. Add the following line between the <code>cmd</code> object declaration and the command <code>context.ExecuteCommandBuffer(cmd)</code>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   cmd.DrawMesh(_mesh, Matrix4x4.identity, _material);</div>
</div><!-- fragment --><p class="startli">To ensure that <a class="el" href="namespace_unity.html">Unity</a> does call the <code>DrawMesh</code> method with <code>null</code> arguments, in the <code>AddRenderPasses</code> method, wrap the <code>EnqueuePass</code> call in the null check condition:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="keywordflow">if</span> (material != null &amp;&amp; mesh != null)</div>
<div class="line">   {</div>
<div class="line">       renderer.EnqueuePass(_lensFlarePass);</div>
<div class="line">   }</div>
</div><!-- fragment --></li>
</ol>
<p>Now the <code>LensFlarePass</code> class has the following basic logic in the <code>Execute</code> method:</p>
<ol type="1">
<li>Get the new command buffer and assign it the name <code>LensFlarePass</code>.</li>
<li>Add rendering commands.</li>
<li>Execute the command buffer.</li>
<li>Release the buffer.</li>
</ol>
<blockquote class="doxtable">
<p>&zwj;<b>NOTE:</b> <a class="el" href="namespace_unity.html">Unity</a> does not enqueue the <code>LensFlarePass</code> pass yet, because the <code>Material</code> and the <code>Mesh</code> properties are null. </p>
</blockquote>
<p>Below is the complete code for this part.</p>
<div class="fragment"><div class="line"><span class="preprocessor"> #</span></div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_unity_engine.html">UnityEngine</a>;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering.Universal;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>LensFlareRendererFeature : <a class="code hl_class" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer_feature.html">ScriptableRendererFeature</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">class </span>LensFlarePass : <a class="code hl_class" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_render_pass.html">ScriptableRenderPass</a></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">private</span> Material _material;</div>
<div class="line">        <span class="keyword">private</span> Mesh _mesh;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">public</span> LensFlarePass(Material material, Mesh mesh)</div>
<div class="line">        {</div>
<div class="line">            _material = material;</div>
<div class="line">            _mesh = mesh;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Execute(ScriptableRenderContext context,</div>
<div class="line">            ref <a class="code hl_struct" href="struct_unity_engine_1_1_rendering_1_1_universal_1_1_rendering_data.html">RenderingData</a> renderingData)</div>
<div class="line">        {</div>
<div class="line">            CommandBuffer cmd = CommandBufferPool.Get(name: <span class="stringliteral">&quot;LensFlarePass&quot;</span>);</div>
<div class="line">            cmd.DrawMesh(_mesh, Matrix4x4.identity, _material);</div>
<div class="line">            context.ExecuteCommandBuffer(cmd);</div>
<div class="line">            CommandBufferPool.Release(cmd);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> LensFlarePass _lensFlarePass;</div>
<div class="line">    <span class="keyword">public</span> <a class="code hl_enumvalue" href="namespace_unity_editor_1_1_rendering_1_1_universal.html#a7dc4ea5121011414a2a206509b9d5442ad92a8333dd3ccb895cc65f7455b71206">Material</a> material;</div>
<div class="line">    <span class="keyword">public</span> Mesh mesh;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Create()</div>
<div class="line">    {</div>
<div class="line">        _lensFlarePass = <span class="keyword">new</span> LensFlarePass(material, mesh);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> AddRenderPasses(<a class="code hl_class" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer.html">ScriptableRenderer</a> renderer,</div>
<div class="line">        ref <a class="code hl_struct" href="struct_unity_engine_1_1_rendering_1_1_universal_1_1_rendering_data.html">RenderingData</a> renderingData)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (material != null &amp;&amp; mesh != null)</div>
<div class="line">        {</div>
<div class="line">            renderer.<a class="code hl_function" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer.html#adef70d792e8e83c7feab314db83b02f2">EnqueuePass</a>(_lensFlarePass);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="anamespace_unity_editor_1_1_rendering_1_1_universal_html_a7dc4ea5121011414a2a206509b9d5442ad92a8333dd3ccb895cc65f7455b71206"><div class="ttname"><a href="namespace_unity_editor_1_1_rendering_1_1_universal.html#a7dc4ea5121011414a2a206509b9d5442ad92a8333dd3ccb895cc65f7455b71206">UnityEditor.Rendering.Universal.ConverterId.Material</a></div><div class="ttdeci">@ Material</div><div class="ttdoc">Use this for the material converters.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2402"></a>
<a class="anchor" id="example-specific-material"></a>Implement the example-specific Material and rendering code</h1>
<p>This section shows how to create a Material for the lens flare effect and how to implement the code to render flares at the positions of Lights.</p>
<ol type="1">
<li>Create a new Material, and assign it the <code>Universal Render Pipeline/Unlit</code> shader. Call the Material <code>LensFlare</code>.</li>
</ol>
<ol type="1">
<li>For demonstration purpose, change the base color of the Material to red.</li>
<li><p class="startli">In the Universal Renderer, in <code>Lens Flare Renderer Feature</code>, select the <code>LensFlare</code> Material in the Material property, and the <code>Quad</code> mesh in the Mesh property.</p>
<p class="startli"><img src="../Images/customizing-urp/custom-renderer-feature/select-mesh-and-material.png" alt="" class="inline"/></p>
</li>
<li><p class="startli">The Renderer Feature draws the quad in the Scene, but at this point it's just black. This is because the <code>Universal Render Pipeline/Unlit</code> shader has multiple passes, and one of them paints the quad black. To change this behavior, use the <code>cmd.DrawMesh</code> method overload that accepts the <code>shaderPass</code> argument, and specify shader pass 0:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   cmd.DrawMesh(_mesh, Matrix4x4.identity, _material, 0, 0);</div>
</div><!-- fragment --></li>
</ol>
<p>The following steps show the changes that are specific to the effect implementation in this example. They are for illustrative purposes.</p>
<ol type="1">
<li><p class="startli">Add the following lines in the <code>Execute</code> method. Place them after the <code>cmd</code> object declaration. These lines ensure that <a class="el" href="namespace_unity.html">Unity</a> draws the quad with the flare in the following way:</p>
<ul>
<li>
In the screen space. </li>
<li>
With the correct aspect ratio. </li>
<li>
For each Light, in the center of the Light. </li>
</ul>
<div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line">   <span class="comment">// Get the Camera data from the renderingData argument.</span></div>
<div class="line">   Camera camera = renderingData.cameraData.camera;</div>
<div class="line">   <span class="comment">// Set the projection matrix so that Unity draws the quad in screen space</span></div>
<div class="line">   cmd.SetViewProjectionMatrices(Matrix4x4.identity, Matrix4x4.identity);</div>
<div class="line">   <span class="comment">// Add the scale variable, use the Camera aspect ratio for the y coordinate</span></div>
<div class="line">   Vector3 scale = <span class="keyword">new</span> Vector3(1, camera.aspect, 1);</div>
<div class="line">   <span class="comment">// Draw a quad for each Light, at the screen space position of the Light.</span></div>
<div class="line">   <span class="keywordflow">foreach</span> (VisibleLight visibleLight <span class="keywordflow">in</span> renderingData.lightData.visibleLights)</div>
<div class="line">   {</div>
<div class="line">       Light light = visibleLight.light;</div>
<div class="line">       <span class="comment">// Convert the position of each Light from world to viewport point.</span></div>
<div class="line">       Vector3 position =</div>
<div class="line">           camera.WorldToViewportPoint(light.transform.position) * 2 - Vector3.one;</div>
<div class="line">       <span class="comment">// Set the z coordinate of the quads to 0 so that Uniy draws them on the same plane.</span></div>
<div class="line">       position.z = 0;</div>
<div class="line">       <span class="comment">// Change the Matrix4x4 argument in the cmd.DrawMesh method to use the position and</span></div>
<div class="line">       <span class="comment">// the scale variables.</span></div>
<div class="line">       cmd.DrawMesh(_mesh, Matrix4x4.TRS(position, Quaternion.identity, scale),</div>
<div class="line">           _material, 0, 0);</div>
<div class="line">   }</div>
</div><!-- fragment --><p class="startli">Now <a class="el" href="namespace_unity.html">Unity</a> draws a quad in the center of each Light.</p>
<p class="startli"><img src="../Images/customizing-urp/custom-renderer-feature/quad-in-screen-space-on-light.png" alt="" class="inline"/></p>
</li>
<li><p class="startli">To visualize the lens flare, make the following changes to the <code>LensFlare</code> Material.</p>
<p class="startli">Add the following texture to the base map:<br  />
<img src="../Images/customizing-urp/custom-renderer-feature/lens-flare-texture.png" alt="Lens flare texture." class="inline"/></p>
<p class="startli">Set the color to white.</p>
<p class="startli">Set <code>Surface Type</code> to <code>Transparent</code>.</p>
<p class="startli">Set <code>Blending Mode</code> to <code>Additive</code>.</p>
</li>
</ol>
<p>Now <a class="el" href="namespace_unity.html">Unity</a> draws the lens flare texture on the quad, but a part of the flare is not visible:</p>
<p><img src="../Images/customizing-urp/custom-renderer-feature/skybox-after-lens-flare.png" alt="" class="inline"/></p>
<p>This is because <a class="el" href="namespace_unity.html">Unity</a> draws the skybox after the <code>LensFlarePass</code> render pass.</p>
<h1><a class="anchor" id="autotoc_md2403"></a>
<a class="anchor" id="order-of-passes"></a>Change the order of the render passes</h1>
<p>To see the order in which <a class="el" href="namespace_unity.html">Unity</a> draws the render passes, open the <b>Frame Debugger</b> (<b>Window</b> &gt; <b>Analysis</b> &gt; <b>Frame&amp;#160;Debugger</b>).</p>
<p><img src="../Images/customizing-urp/custom-renderer-feature/frame-debug-view.png" alt="" class="inline"/></p>
<p>To enqueue the <code>LensFlarePass</code> pass after the skybox pass, use the <code>renderPassEvent</code> property of <code>LensFlarePass</code>. Assign the property the <code>AfterRenderingSkybox</code> event from the <code>RenderPassEvent</code> enum.</p>
<p>Make the following changes in the <code>Create</code> method:</p>
<div class="fragment"><div class="line"><span class="preprocessor"> #</span></div>
<div class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Create()</div>
<div class="line">{</div>
<div class="line">    _lensFlarePass = <span class="keyword">new</span> LensFlarePass(material, mesh);</div>
<div class="line">    <span class="comment">// Draw the lens flare effect after the skybox.</span></div>
<div class="line">    _lensFlarePass.renderPassEvent = <a class="code hl_enumeration" href="namespace_unity_engine_1_1_rendering_1_1_universal.html#abcf86de95108d2ec392bc873e92392d5">RenderPassEvent</a>.AfterRenderingSkybox;</div>
<div class="line">}</div>
<div class="ttc" id="anamespace_unity_engine_1_1_rendering_1_1_universal_html_abcf86de95108d2ec392bc873e92392d5"><div class="ttname"><a href="namespace_unity_engine_1_1_rendering_1_1_universal.html#abcf86de95108d2ec392bc873e92392d5">UnityEngine.Rendering.Universal.RenderPassEvent</a></div><div class="ttdeci">RenderPassEvent</div><div class="ttdoc">Controls when the render pass executes.</div><div class="ttdef"><b>Definition</b> ScriptableRenderPass.cs:52</div></div>
</div><!-- fragment --><p>Now <a class="el" href="namespace_unity.html">Unity</a> draws the lens flare on top of the skybox.</p>
<p><img src="../Images/customizing-urp/custom-renderer-feature/final-lens-flare-view.png" alt="" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md2404"></a>
<a class="anchor" id="complete-code"></a>Complete code for this example</h1>
<p>Below is the complete code for this example.</p>
<div class="fragment"><div class="line"><span class="preprocessor"> #</span></div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_unity_engine.html">UnityEngine</a>;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering;</div>
<div class="line"><span class="keyword">using </span>UnityEngine.Rendering.Universal;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>LensFlareRendererFeature : <a class="code hl_class" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer_feature.html">ScriptableRendererFeature</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">class </span>LensFlarePass : <a class="code hl_class" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_render_pass.html">ScriptableRenderPass</a></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">private</span> Material _material;</div>
<div class="line">        <span class="keyword">private</span> Mesh _mesh;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">public</span> LensFlarePass(Material material, Mesh mesh)</div>
<div class="line">        {</div>
<div class="line">            _material = material;</div>
<div class="line">            _mesh = mesh;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Execute(ScriptableRenderContext context,</div>
<div class="line">            ref <a class="code hl_struct" href="struct_unity_engine_1_1_rendering_1_1_universal_1_1_rendering_data.html">RenderingData</a> renderingData)</div>
<div class="line">        {</div>
<div class="line">            CommandBuffer cmd = CommandBufferPool.Get(name: <span class="stringliteral">&quot;LensFlarePass&quot;</span>);</div>
<div class="line">            <span class="comment">// Get the Camera data from the renderingData argument.</span></div>
<div class="line">            Camera camera = renderingData.cameraData.camera;</div>
<div class="line">            <span class="comment">// Set the projection matrix so that Unity draws the quad in screen space.</span></div>
<div class="line">            cmd.SetViewProjectionMatrices(Matrix4x4.identity, Matrix4x4.identity);</div>
<div class="line">            <span class="comment">// Add the scale variable, use the Camera aspect ratio for the y coordinate</span></div>
<div class="line">            Vector3 scale = <span class="keyword">new</span> Vector3(1, camera.aspect, 1);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Draw a quad for each Light, at the screen space position of the Light.</span></div>
<div class="line">            <span class="keywordflow">foreach</span> (VisibleLight visibleLight <span class="keywordflow">in</span> renderingData.lightData.visibleLights)</div>
<div class="line">            {</div>
<div class="line">                Light light = visibleLight.light;</div>
<div class="line">                <span class="comment">// Convert the position of each Light from world to viewport point.</span></div>
<div class="line">                Vector3 position =</div>
<div class="line">                    camera.WorldToViewportPoint(light.transform.position) * 2 - Vector3.one;</div>
<div class="line">                <span class="comment">// Set the z coordinate of the quads to 0 so that Uniy draws them on the same</span></div>
<div class="line">                <span class="comment">// plane.</span></div>
<div class="line">                position.z = 0;</div>
<div class="line">                <span class="comment">// Change the Matrix4x4 argument in the cmd.DrawMesh method to use</span></div>
<div class="line">                <span class="comment">// the position and the scale variables.</span></div>
<div class="line">                cmd.DrawMesh(_mesh, Matrix4x4.TRS(position, Quaternion.identity, scale),</div>
<div class="line">                    _material, 0, 0);</div>
<div class="line">            }</div>
<div class="line">            context.ExecuteCommandBuffer(cmd);</div>
<div class="line">            CommandBufferPool.Release(cmd);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> LensFlarePass _lensFlarePass;</div>
<div class="line">    <span class="keyword">public</span> <a class="code hl_enumvalue" href="namespace_unity_editor_1_1_rendering_1_1_universal.html#a7dc4ea5121011414a2a206509b9d5442ad92a8333dd3ccb895cc65f7455b71206">Material</a> material;</div>
<div class="line">    <span class="keyword">public</span> Mesh mesh;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Create()</div>
<div class="line">    {</div>
<div class="line">        _lensFlarePass = <span class="keyword">new</span> LensFlarePass(material, mesh);</div>
<div class="line">        <span class="comment">// Draw the lens flare effect after the skybox.</span></div>
<div class="line">        _lensFlarePass.renderPassEvent = <a class="code hl_enumeration" href="namespace_unity_engine_1_1_rendering_1_1_universal.html#abcf86de95108d2ec392bc873e92392d5">RenderPassEvent</a>.AfterRenderingSkybox;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> AddRenderPasses(<a class="code hl_class" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer.html">ScriptableRenderer</a> renderer, ref <a class="code hl_struct" href="struct_unity_engine_1_1_rendering_1_1_universal_1_1_rendering_data.html">RenderingData</a> renderingData)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (material != null &amp;&amp; mesh != null)</div>
<div class="line">        {</div>
<div class="line">            renderer.<a class="code hl_function" href="class_unity_engine_1_1_rendering_1_1_universal_1_1_scriptable_renderer.html#adef70d792e8e83c7feab314db83b02f2">EnqueuePass</a>(_lensFlarePass);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
